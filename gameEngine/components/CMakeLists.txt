
cmake_minimum_required(VERSION 3.15)
project(ECS_Components)

file(GLOB COMPONENT_DIRS RELATIVE ${CMAKE_CURRENT_SOURCE_DIR} "*")

message(STATUS "=== Component Discovery ===")

set(DISCOVERED_COMPONENTS "")

foreach(DIR ${COMPONENT_DIRS})
    if(IS_DIRECTORY "${CMAKE_CURRENT_SOURCE_DIR}/${DIR}")
        if(EXISTS "${CMAKE_CURRENT_SOURCE_DIR}/${DIR}/CMakeLists.txt")
            message(STATUS "  âœ“ Component found: ${DIR}")
            add_subdirectory(${DIR})
            list(APPEND DISCOVERED_COMPONENTS ${DIR})
        endif()
    endif()
endforeach()

set(ECS_COMPONENTS ${DISCOVERED_COMPONENTS} CACHE INTERNAL "ECS Component List")

set(MANIFEST_FILE "${CMAKE_CURRENT_BINARY_DIR}/components_manifest.txt")
file(WRITE ${MANIFEST_FILE} "# ECS Components Manifest\n")
file(APPEND ${MANIFEST_FILE} "# Generated by CMake\n\n")
foreach(COMP ${DISCOVERED_COMPONENTS})
    file(APPEND ${MANIFEST_FILE} "${COMP}\n")
endforeach()

install(FILES ${MANIFEST_FILE}
    DESTINATION share/ecs
)