cmake_minimum_required(VERSION 3.15)
project(ECS_Systems)

file(GLOB SYSTEM_DIRS RELATIVE ${CMAKE_CURRENT_SOURCE_DIR} "*")

message(STATUS "=== System Discovery ===")

set(DISCOVERED_SYSTEMS "")

foreach(DIR ${SYSTEM_DIRS})
    if(IS_DIRECTORY "${CMAKE_CURRENT_SOURCE_DIR}/${DIR}")
        if(EXISTS "${CMAKE_CURRENT_SOURCE_DIR}/${DIR}/CMakeLists.txt")
            message(STATUS "  âœ“ System found: ${DIR}")
            add_subdirectory(${DIR})
            list(APPEND DISCOVERED_SYSTEMS ${DIR})
        endif()
    endif()
endforeach()

set(ECS_SYSTEMS ${DISCOVERED_SYSTEMS} CACHE INTERNAL "ECS System List")

set(MANIFEST_FILE "${CMAKE_CURRENT_BINARY_DIR}/systems_manifest.txt")
file(WRITE ${MANIFEST_FILE} "# ECS Systems Manifest\n")
file(APPEND ${MANIFEST_FILE} "# Generated by CMake\n\n")
foreach(SYS ${DISCOVERED_SYSTEMS})
    file(APPEND ${MANIFEST_FILE} "${SYS}\n")
endforeach()

install(FILES ${MANIFEST_FILE}
    DESTINATION share/ecs
)